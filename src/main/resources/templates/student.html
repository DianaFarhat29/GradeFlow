<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Student Page</title>
    <link rel="stylesheet" th:href="@{/css/output.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
</head>

<body class="h-screen w-screen overflow-y-hidden overflow-x-hidden bg-gray-200 font-mainFont relative">
    <header class="header sticky top-0 bg-white shadow-md flex items-center justify-between px-8 ">
        <!-- logo -->
        <h1 class="w-3/12 h-full flex flex-row items-center gap-2 ">
            <img th:src="@{/media/pomme.png}" class="h-12 w-12 hover:text-greenLogo duration-200" alt="Logo">
            <span class="text-3xl">GradeFlow</span>
        </h1>
        <!-- Link for Logo: <a href="https://www.flaticon.com/fr/icones-gratuites/pomme" title="pomme icônes">Pomme icônes créées par Freepik - Flaticon</a>-->
        <!-- Link for student icon: <div> Icons made by <a href="https://www.flaticon.com/authors/khld939" title="khld939"> khld939 </a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com'</a></div>-->
        <!-- Link for deconnexion icon:<a href="https://www.flaticon.com/free-icons/logout" title="logout icons">Logout icons created by Pixel perfect - Flaticon</a>-->


        <!-- navigation -->
        <nav class="nav font-semibold text-lg">
            <ul class="flex items-center">
                <li>
                    <a class="flex flex-col text-center items-center group bg-opacity-100 cursor-pointer"
                        th:href="@{/index}">
                        <span class="my-6 px-12  duration-200 group-hover:text-greenLogo">Home</span>
                        <span
                            class="h-1 bg-gradient-to-r from-white via-greenLogo to-white w-full invisible group-hover:visible "></span>
                    </a>
                </li>
                <li>
                    <a class="flex flex-col text-center  group bg-opacity-100 cursor-pointer" th:href="@{/student}">
                        <span class="my-6 px-12  duration-200 group-hover:text-greenLogo">Students</span>
                        <span
                            class="h-1 bg-gradient-to-r from-white via-greenLogo to-white w-full invisible group-hover:visible "></span>
                    </a>
                </li>
                <li>
                    <a class="flex flex-col text-center  group bg-opacity-100 cursor-pointer" th:href="@{/course}">
                        <span class="my-6 px-12  duration-200 group-hover:text-greenLogo">Courses</span>
                        <span
                            class="h-1 bg-gradient-to-r from-white via-greenLogo to-white w-full invisible group-hover:visible "></span>
                    </a>
                </li>
                <li>
                    <a class="flex flex-col text-center  group bg-opacity-100 cursor-pointer" th:href="@{/grade}">
                        <span class="my-6 px-12  duration-200 group-hover:text-greenLogo">Grades</span>
                        <span
                            class="h-1 bg-gradient-to-r from-white via-greenLogo to-white w-full invisible group-hover:visible "></span>
                    </a>
            </ul>
        </nav>

        <!-- buttons -->
        <div class="w-3/12 flex justify-end">
            <a th:href="@{/login}">
                <img th:src="@{/media/logout.png}" class="h-8 w-8 hover:text-greenLogo duration-200" alt="Deconnexion">
            </a>
        </div>
    </header>

    <div class="px-10 pt-10 text-4xl flex gap-2 items-end font-bold justify-center"> 
        <img th:src="@{/media/studentLogo.png}" class="h-12 w-12 hover:text-greenLogo duration-200" alt="student icon"> 
        <span> Students management </span>
    </div>

    <main class="w-full h-full px-10 py-5 flex flex-col ">

        <span> Please choose an option: </span>

        <div class="w-full flex gap-10 py-2">
            <div class="p-3 text-black bg-white w-fit h-fit rounded-md ">

                <input type="checkbox" class=" peer/add" id="addButton" />
                <span class="font-medium text-xl text-gray-600 w-fit p-2">Add a new student</span>

                <div class="w-full bg-white p-4 rounded-md peer-checked/add:block hidden ">

                    <form th:action="@{/student/add}" th:object="${student}" method="post" required
                        class="grid gap-4 gap-y-2 text-sm ">
                        <div class="lg:col-span-2">
                            <div class="grid gap-4 gap-y-2 text-sm grid-cols-7">
                                <div class="md:col-span-1">
                                    <label for="firstName">First name</label>
                                    <input required th:field="*{firstName}" type="text" name="firstName" id="firstName"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="lastName">Last name</label>
                                    <input required th:field="*{lastName}" type="text" name="lastName" id="lastName"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="organisation">Organisation</label>
                                    <input required th:field="*{organisation}" type="text" name="organisation" id="organisation"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="mailingAddress">Adress</label>
                                    <input required th:field="*{mailingAddress}" type="text" name="mailingAddress"
                                        id="mailingAddress" class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="city">City</label>
                                    <input required th:field="*{city}" type="text" name="city" id="city"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="province">Province</label>
                                    <input required th:field="*{province}" type="text" name="province" id="province"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="postalCode">Postal Code</label>
                                    <input required th:field="*{postalCode}" type="text" name="postalCode" id="postalCode"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="country">Country</label>
                                    <input required th:field="*{country}" type="text" name="country" id="country"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="telephone">Telephone</label>
                                    <input required th:field="*{telephone}" type="text" name="telephone" id="telephone"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="fax">Fax</label>
                                    <input required th:field="*{fax}" type="text" name="fax" id="fax"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="email">Email</label>
                                    <input required th:field="*{email}" type="email" name="email" id="email"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50"
                                        placeholder="email@domain.com" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="gender">Gender</label>
                                    <select required th:field="*{gender}" name="gender" id="gender"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50">
                                        <option value="None">Prefer not to say</option>
                                        <option value="Men">Men</option>
                                        <option value="Women">Women</option>

                                    </select>
                                </div>

                                <div class="md:col-span-1">
                                    <label for="dateBirth">Birthdate</label>
                                    <input required th:field="*{dateBirth}" type="date" name="dateBirth" id="dateBirth"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1 flex justify-center ">

                                    <div class="inline-flex items-end w-full">
                                        <button type="submit"
                                            class="bg-greenLogo hover:bg-white hover:text-greenLogo border border-white hover:border-greenLogo transition-colors text-white font-bold h-10 rounded flex justify-center items-center flex-nowrap w-full">Add
                                            to list </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="p-3 text-black bg-white w-fit h-fit rounded-md ">

                <input type="checkbox" class=" peer/edit" id="editButton" />
                <span class="font-medium text-xl text-gray-600 w-fit p-2">Edit/delete an existing student</span>

                <div class="w-full bg-white p-4 rounded-md peer-checked/edit:block hidden">
                    <form th:action="@{/student/update}" th:object="${student}" method="post" required
                        class="grid gap-4 gap-y-2 text-sm ">
                        <div class="lg:col-span-2">
                            <div class="grid gap-4 gap-y-2 text-sm grid-cols-8">
                                <div class="md:col-span-1">
                                    <label for="studentId">ID</label>
                                    <select required id="studentIds" th:field="*{id}"  onchange="loadStudentData()"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50 text-center">
                                        <option selected value="">Choose an id</option>
                                        <th:block th:each="student : ${students}">
                                            <option th:value="${student.id}" th:text="${student.id}" ></option>
                                        </th:block>
                                    </select>

                                </div>
                           
                                <div class="md:col-span-1">
                                    <label for="firstName">First name</label>
                                    <input required th:field="*{firstName}" type="text" name="firstName" id="edit-firstName"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="lastName">Last name</label>
                                    <input required  th:field="*{lastName}" type="text"
                                        name="lastName" id="edit-lastName"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="organisation">Organisation</label>
                                    <input required th:field="*{organisation}" type="text"
                                        name="organisation" id="edit-organisation"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="mailingAddress">Adress</label>
                                    <input required  th:field="*{mailingAddress}" type="text"
                                        name="mailingAddress" id="edit-mailingAddress"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="city">City</label>
                                    <input required  th:field="*{city}" type="text" name="city"
                                        id="edit-city" class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="province">Province</label>
                                    <input required  th:field="*{province}" type="text"
                                        name="province" id="edit-province"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="postalCode">Postal Code</label>
                                    <input required  th:field="*{postalCode}" type="text"
                                        name="postalCode" id="edit-postalCode"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="country">Country</label>
                                    <input required  th:field="*{country}" type="text"
                                        name="country" id="edit-country"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="telephone">Telephone</label>
                                    <input required  th:field="*{telephone}" type="text"
                                        name="telephone" id="edit-telephone"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="fax">Fax</label>
                                    <input required  th:field="*{fax}" type="text" name="fax"
                                        id="edit-fax" class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="email">Email</label>
                                    <input required th:field="*{email}" type="email" name="email"
                                        id="edit-email" class="h-10 border mt-1 rounded px-4 w-full bg-gray-50"
                                        placeholder="email@domain.com" />
                                </div>

                                <div class="md:col-span-1">
                                    <label for="gender">Gender</label>
                                    <select required th:field="*{gender}" name="gender"
                                        id="edit-gender" class="h-10 border mt-1 rounded px-4 w-full bg-gray-50">
                                        <option value="None">Prefer not to say</option>
                                        <option value="Men">Men</option>
                                        <option value="Women">Women</option>
                                    </select>
                                </div>


                                <div class="md:col-span-1">
                                    <label for="dateBirth">Birthdate</label>
                                    <input required th:field="*{dateBirth}" type="date"
                                        name="dateBirth" id="edit-dateBirth"
                                        class="h-10 border mt-1 rounded px-4 w-full bg-gray-50" />
                                </div>
                                <div class="inline-flex items-end">
                                    <button type="submit" id="updateButton"
                                        class="bg-greenLogo hover:bg-white hover:text-greenLogo border border-white hover:border-greenLogo transition-colors text-white font-bold h-10 rounded  flex justify-center items-center flex-nowrap w-full">Update</button>
                                </div>
                                <div class="inline-flex items-end">
                                    <button type="button" id="deleteButton"
                                        class="bg-red-600 hover:bg-white hover:text-red-600 border border-white hover:border-red-600 transition-colors text-white font-bold h-10 rounded flex justify-center items-center flex-nowrap w-full ">
                                        Delete
                                    </button>

                                </div>
                            </div>
                        </div>

                    </form>

                </div>
            </div>

        </div>


        </div>


        <div class="w-full h-full gap-2 py-5 flex flex-col">

            <div class="w-full flex ">
                <form th:action="@{/student/searchresults}" th:object="${student}" method="get"
                    class="w-full h-full bg-white p-2 bg-opacity-75 text-sm shadow-md rounded-md flex justify-stretch">
                    <div class="text-xl mb-4 flex justify-center items-center h-full px-5"> Students List</div>
                    <div class="h-full flex px-2 gap-5">
                        <input type="text" th:field="*{id}" name="id" id="id" placeholder="Search by id..."
                            class="border border-greyBack px-2 my-1 rounded" />
                        <input type="text" th:field="*{firstName}" name="firstName" id="firstName"
                            placeholder="Search by first name..." class="border border-greyBack px-2 my-1 rounded" />
                        <input type="text" th:field="*{lastName}" name="lastName" id="lastName"
                            placeholder="Search by last name..." class="border border-greyBack px-2 my-1 rounded" />

                        <div>
                        </div>
                    </div>
                    <div class="flex-1 h-full flex justify-end gap-2 px-2">
                        <button type="submit"
                            class="bg-black text-md hover:bg-white border my-1 border-white hover:border-greenLogo hover:text-black text-white font-bold py-1 px-8 rounded transition-colors flex justify-center items-center">Filtrer</button>
                        <a th:href="@{/student}"
                            class="bg-gray-400 text-md hover:bg-white border my-1 border-greyBack hover:text-black text-white font-bold py-1 px-8 rounded transition-colors flex justify-center items-center">Reset</a>
                    </div>
                </form>

            </div>
            <div class="h-1/2 overflow-y-auto border-greyBack border-opacity-80  shadow-md rounded-md">

                <div class="w-full flex flex-col h-full text-center bg-white  ">
                    <table>
                        <tr
                            class="text-md w-full border-b-4 border-greyBack border-opacity-50 text-black font-bold  bg-grayList ">
                            <th class="p-3 border-r  border-greyBack"> ID </th>
                            <th class="p-3 border-r  border-greyBack"> First Name</th>
                            <th class="p-3 border-r  border-greyBack"> Last Name</th>
                            <th class="p-3 border-r  border-greyBack"> Organisation</th>
                            <th class="p-3 border-r  border-greyBack"> Adress</th>
                            <th class="p-3 border-r  border-greyBack"> City</th>
                            <th class="p-3 border-r  border-greyBack"> Province</th>
                            <th class="p-3 border-r  border-greyBack"> Postal Code</th>
                            <th class="p-3 border-r  border-greyBack"> Country</th>
                            <th class="p-3 border-r  border-greyBack"> Telephone</th>
                            <th class="p-3 border-r  border-greyBack"> Fax</th>
                            <th class="p-3 border-r  border-greyBack"> Email</th>
                            <th class="p-3 border-r  border-greyBack"> Gender </th>
                            <th class="p-3"> Birthdate</th>


                        </tr>

                        <tr th:each="student : ${students}" th:if="${students != null and !students.isEmpty()}"
                            class="text-sm w-full overflow-y flex-1 bg-white rounded-bl-md">
                            <td th:text="${student.id}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50 bg-white">
                                Id code</td>
                            <td th:text="${student.firstName}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> First Name</td>
                            <td th:text="${student.lastName}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Last Name</td>
                            <td th:text="${student.organisation}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Organisation</td>
                            <td th:text="${student.mailingAddress}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Adress</td>
                            <td th:text="${student.city}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> City</td>
                            <td th:text="${student.province}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Province</td>
                            <td th:text="${student.postalCode}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Postal Code</td>
                            <td th:text="${student.country}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Country</td>
                            <td th:text="${student.telephone}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Telephone</td>
                            <td th:text="${student.fax}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Fax</td>
                            <td th:text="${student.email}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Email</td>
                            <td th:text="${student.gender}"
                                class="p-3 border-r border-b border-greyBack border-opacity-50"> Gender </td>
                            <td th:text="${student.dateBirth}" class="p-3 border-b border-greyBack border-opacity-50">
                                Birthdate</td>
                        </tr>

                    </table>
                    <div class="text-md w-full h-full gap-4 overflow-y flex-1 bg-white rounded-bl-md flex flex-col justify-center items-center"
                        th:if="${students.isEmpty()}">
                        <span class="font-bold"> No result found. </span>
                        <!-- Source of image: <a href="https://www.flaticon.com/free-icons/no-results" title="no results icons">No results icons created by Freepik - Flaticon</a> -->
                        <img th:src="@{/media/noResults.png}" class="h-28 w-28" alt="noResult">
                    </div>
                </div>
            </div>
        </div>


    </main>


    <footer class="bg-white shadow dark:bg-gray-800 w-full fixed bottom-0 left-0">
        <div class="w-full px-7 py-4 flex justify-between">
            <span class="text-sm text-gray-500 item-left dark:text-gray-400">© 2023 <a href=""
                    class="hover:underline">GradeFlow™</a>. All Rights Reserved.
            </span>
            <ul class="flex flex-wrap items-center mt-3 text-sm font-medium text-gray-500 dark:text-gray-400 sm:mt-0">
                <li>
                    <a th:href="@{/index}" class="mr-4 hover:underline md:mr-6">Home</a>
                </li>
                <li>
                    <a th:href="@{/student}" class="mr-4 hover:underline md:mr-6">Students</a>
                </li>
                <li>
                    <a th:href="@{/course}" class="mr-4 hover:underline md:mr-6">Courses</a>
                </li>
                <li>
                    <a th:href="@{/grade}" class="mr-4 hover:underline md:mr-6">Grades</a>
                </li>
            </ul>
        </div>
    </footer>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var students = /*[[${students}]]*/[];
        function loadStudentData() {
            var id = document.getElementById("studentIds").value;
            var selectedStudent = students.find(s => s.id == id);
            if (selectedStudent && id != "") {
                document.getElementById("edit-firstName").value = selectedStudent.firstName;
                document.getElementById("edit-lastName").value = selectedStudent.lastName;
                document.getElementById("edit-organisation").value = selectedStudent.organisation;
                document.getElementById("edit-mailingAddress").value = selectedStudent.mailingAddress;
                document.getElementById("edit-city").value = selectedStudent.city;
                document.getElementById("edit-province").value = selectedStudent.province;
                document.getElementById("edit-postalCode").value = selectedStudent.postalCode;
                document.getElementById("edit-country").value = selectedStudent.country;
                document.getElementById("edit-telephone").value = selectedStudent.telephone;
                document.getElementById("edit-fax").value = selectedStudent.fax;
                document.getElementById("edit-email").value = selectedStudent.email;
                document.getElementById("edit-gender").value = selectedStudent.gender;
                document.getElementById("edit-dateBirth").value = selectedStudent.dateBirth;
            }
            console.log(selectedStudent);
            console.log(id);
            console.log(students);
        }
        /*]]>*/

        document.getElementById('deleteButton').addEventListener('click', function () {
            var id = document.getElementById("studentIds").value;
            let validationDelete;
            if(id !== "") {
            validationDelete = prompt("Are you sure you want to delete this student? (y/n)")
            }
            else {
                alert("Choose an id of student to delete.")
            }

            if (validationDelete == "y" ) {
            fetch('student/delete/' + id, { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = "/student";
                    } else {
                        // Gérez les erreurs, montrez un message à l'utilisateur, etc.
                        console.log("Tried to delete id# " + id)
                        console.error('Erreur lors de la suppression');
                    }
                });
            }
            else {
                window.location.href = "/student";
            }
        });
        

    </script>

</body>






</html>